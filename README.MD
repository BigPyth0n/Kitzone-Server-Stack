
# 🚀 KITZONE Server Setup v2.0

**🔧 Script: `main.sh` — نصب و راه‌اندازی کامل PostgreSQL، Metabase، Grafana، Code-Server، pgAdmin، Portainer، و Nginx Proxy Manager در کمتر از ۱۰ دقیقه!**

---

## 📌 معرفی و هدف

`main.sh` یک اسکریپت بش حرفه‌ای و تمام‌خودکار است که با اجرای آن، سرور لینوکسی شما به یک محیط قدرتمند برای مدیریت داده، توسعه، مانیتورینگ و تحلیل تبدیل می‌شود. هدف از این پروژه، ارائه یک نقطه شروع سریع و امن برای تیم‌های توسعه، تحلیل داده، DevOps و مدیران پروژه است.

---

## 📊 جدول سرویس‌ها

| سرویس                 | توضیح                                   | پورت دسترسی     |
|----------------------|------------------------------------------|------------------|
| **PostgreSQL**       | پایگاه داده SQL                         | `5432`           |
| **Metabase**         | داشبورد هوش تجاری                       | `3000`           |
| **Grafana**          | مانیتورینگ و گراف تحلیلی                | `3001`           |
| **pgAdmin**          | مدیریت PostgreSQL از طریق رابط وب      | `5050`           |
| **Code-Server**      | محیط برنامه‌نویسی VS Code در مرورگر     | `8443` (HTTPS)   |
| **Portainer**        | مدیریت گرافیکی کانتینرهای Docker        | `9000`           |
| **Nginx Proxy Manager** | مدیریت دامنه‌ها و SSL                 | `81` (Admin), `443`, `80` |

---

## 🧰 پیش‌نیازها

- Ubuntu 20.04 یا 22.04 (تست شده)
- دسترسی root یا sudo
- پورت‌های باز: `80`, `443`, `5432`, `8443`, `3000`, `3001`, `5050`, `9000`, `81`
- نصب بودن `curl` و `bash`

---


## 📦 راهنمای نصب قدم‌به‌قدم

```bash
bash <(curl -fsSL https://raw.githubusercontent.com/your-username/kitzone-server-setup/main/main.sh)
```
🔐 در حین اجرا، از شما پسورد PostgreSQL و Code-Server درخواست می‌شود. رمزها به صورت امن در `/root/postgres-credentials.txt` ذخیره می‌شوند.


🟡 در حین اجرا، از شما پسورد PostgreSQL و Code-Server درخواست می‌شود. رمزها به صورت امن در `/root/postgres-credentials.txt` ذخیره می‌شوند.

---

## 🔐 پیکربندی کامل SSL در Nginx Proxy Manager

### مرحله 1: ورود به NPM
- آدرس: `http://YOUR-IP:81`
- ایمیل پیش‌فرض: `admin@example.com`
- رمز پیش‌فرض: `changeme`

### مرحله 2: افزودن دامنه
- وارد بخش "Proxy Hosts" شوید
- دامنه‌تان را اضافه کنید و به آدرس داخلی یکی از سرویس‌ها (مثلاً `http://code-server:8443`) متصل کنید

### مرحله 3: فعال‌سازی SSL
- در هنگام افزودن، تیک SSL را فعال کرده و از **Let's Encrypt** استفاده کنید
- گزینه "Force SSL" و "HTTP/2 Support" را نیز فعال نمایید

### مرحله 4: اطمینان از عملکرد
- دامنه را در مرورگر باز کنید و گواهی امن را بررسی نمایید

---

## 🔄 مدیریت و بروزرسانی

### مشاهده لاگ کانتینرها:
```bash
docker logs -f code-server
```

### ریستارت یک سرویس:
```bash
docker restart grafana
```

### حذف کامل همه سرویس‌ها:
```bash
docker stop $(docker ps -q)
docker rm -f $(docker ps -aq)
```

### بروزرسانی ایمیج‌ها:
```bash
docker pull linuxserver/code-server
docker pull postgres:15-alpine
# و به همین ترتیب بقیه...
```

---

## 🛡️ توصیه‌های امنیتی

1. بلافاصله رمزهای پیش‌فرض (مثل NPM و Code-Server) را تغییر دهید
2. اگر سرور در اینترنت قرار دارد، دسترسی به پورت‌های حساسی مثل 5432 را محدود کنید:
   ```bash
   sudo ufw allow from YOUR_IP to any port 5432
   ```
3. استفاده از کلید SSH به جای رمز برای ورود به سرور
4. پشتیبان‌گیری منظم از مسیرهای زیر:
   - `/opt/postgres/data`
   - `/opt/grafana/data`
   - `/opt/pgadmin/data`
   - `/opt/metabase/data`

---

## 🧩 عیب‌یابی (Troubleshooting)

| مشکل                         | راه‌حل پیشنهادی                                       |
|-----------------------------|--------------------------------------------------------|
| پورت باز نیست               | بررسی `ufw status` و اطمینان از باز بودن پورت |
| سرویس بالا نمی‌آید          | بررسی با `docker logs <container_name>`          |
| رمز PostgreSQL را گم کردم   | بررسی فایل `/root/postgres-credentials.txt`       |
| دسترسی به دامنه SSL ندارم   | پورت‌های 80 و 443 باید در فایروال باز باشند         |

---

## ❓ سوالات متداول (FAQ)

### 1. آیا می‌توانم دامنه اختصاصی وصل کنم؟
بله، کافیست DNS دامنه را به IP سرور تنظیم کرده و در Nginx Proxy Manager آن را ثبت کنید.

### 2. آیا پسوردها رمزنگاری‌شده‌اند؟
خیر، در فایل `/root/postgres-credentials.txt` به‌صورت `chmod 600` ذخیره شده‌اند. استفاده از Vault یا GPG پیشنهاد می‌شود.

### 3. چطور می‌توانم این اسکریپت را مجدد اجرا کنم؟
محدودیتی نیست، ولی اجرای مجدد ممکن است کانتینرهای فعلی را بازنویسی کند. ابتدا کانتینرهای قدیمی را حذف کنید یا اسکریپت را به نسخه‌ای پیشرفته‌تر ارتقاء دهید.

---

## ❤️ با عشق توسط تیم KitZone

> هر سوال یا پیشنهادی دارید، Issue یا Pull Request بسازید 🙌  
> برای مشارکت، لطفاً فایل `CONTRIBUTING.md` را مطالعه کنید.
